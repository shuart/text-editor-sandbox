{"mappings":"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","sources":["src/index.js","src/customPlugins.js","src/mention/index.js","src/mention/mentionPlugin.js","src/mention/utils.js","src/mention/nodes.js"],"sourcesContent":["import {EditorState} from \"prosemirror-state\"\nimport {EditorView} from \"prosemirror-view\"\nimport {Schema, DOMParser} from \"prosemirror-model\"\nimport {schema} from \"prosemirror-schema-basic\"\nimport {addListNodes} from \"prosemirror-schema-list\"\nimport {exampleSetup} from \"prosemirror-example-setup\"\nimport {keymap} from \"prosemirror-keymap\"\nimport {lintPlugin} from \"./customPlugins.js\"\nimport {addMentionNodes, addTagNodes,addArrowNodes, getMentionsPlugin} from './mention'\n\n// Mix the nodes from prosemirror-schema-list into the basic schema to\n// create a schema with list support.\n//const mySchema = new Schema({\n//  nodes: addListNodes(schema.spec.nodes, \"paragraph block*\", \"block\"),\n//  marks: schema.spec.marks\n//})\n\n\nvar mySchema = new Schema( {\n    nodes: addArrowNodes( addTagNodes( addMentionNodes(addListNodes(schema.spec.nodes, \"paragraph block*\", \"block\")) ) ),\n    marks: schema.spec.marks\n});\n\n\n//Mention\n/**\n * IMPORTANT: outer div's \"suggestion-item-list\" class is mandatory. The plugin uses this class for querying.\n * IMPORTANT: inner div's \"suggestion-item\" class is mandatory too for the same reasons\n */\nvar getMentionSuggestionsHTML = items => '<div class=\"suggestion-item-list\">'+\n  items.map(i => '<div class=\"suggestion-item\">'+i.name+'</div>').join('')+\n'</div>';\n\n/**\n * IMPORTANT: outer div's \"suggestion-item-list\" class is mandatory. The plugin uses this class for querying.\n * IMPORTANT: inner div's \"suggestion-item\" class is mandatory too for the same reasons\n */\nvar getTagSuggestionsHTML = items => '<div class=\"suggestion-item-list\">'+\n  items.map(i => '<div class=\"suggestion-item\">'+i.tag+'</div>').join('')+\n'</div>';\n\nvar plugins = exampleSetup({schema: mySchema}).concat(lintPlugin)\n\n// function insertTab(state, dispatch) {\n//   let type = mySchema.nodes.text\n//   let {$from} = state.selection\n//   if (!$from.parent.canReplaceWith($from.index(), $from.index(), type))\n//     return false\n//   dispatch(state.tr.replaceSelectionWith(type.create()))\n//   return true\n// }\nfunction insertTab(state, dispatch) {\n  dispatch(state.tr.insertText(\"    \"))\n  return true\n}\n\nfunction getNodeEndpoints(context, node) {\n  let offset = 0\n\n  if(context === node) return { from: offset, to: offset + node.nodeSize }\n\n  if(node.isBlock) {\n    for(let i=0; i<context.content.content.length; i++) {\n      let result = getNodeEndpoints(context.content.content[i], node)\n      if(result) return {\n        from: result.from + offset + (context.type.kind === null ? 0 : 1),\n        to: result.to + offset + (context.type.kind === null ? 0 : 1)\n      }\n      offset += context.content.content[i].nodeSize\n    }\n    return null\n  } else {\n    return null\n  }\n}\n\nvar customKM = keymap({\n  \"Tab\": insertTab,\n    });\n\nfunction findRegExp(findTerm,caseSensitive) {\n    return RegExp(findTerm, !caseSensitive ? \"i\" : \"\")\n  }\nfunction findInNode(root, node, term) {\n  console.log(findRegExp(term))\n  console.log(node)\n  var findResult = term;\n  console.log(findResult)\n  if (findResult.findRegExp == undefined){\n    console.log(findResult.findRegExp )\n    findResult ={\n      findTerm:[],\n      findRegExp:findRegExp(term),\n    }\n  }\n  let ret = []\n\n  if(node.text) {\n    let index = 0, foundAt, ep = getNodeEndpoints(root, node)\n    while((foundAt = node.textContent.slice(index).search(findResult.findRegExp)) > -1) {\n      let sel = new TextSelection(ep.from + index + foundAt + 1, ep.from + index + foundAt + findResult.findTerm.length + 1)\n      ret.push(sel)\n      index = index + foundAt + findResult.findTerm.length\n    }\n  } else {\n    node.content.forEach((child, i) => ret = ret.concat(findInNode(root,child, findResult)))\n  }\n  console.log(ret)\n  return ret\n}\n\nvar mentionPlugin = getMentionsPlugin({\n    functionOnClick: (event, view)=> {\n      console.log(view) \n      findInNode(view.state.doc, view.state.doc, \"test\")\n      //console.log(\"teest\")\n    },\n    getSuggestions: (type, text, done) => {\n      setTimeout(() => {\n        if (type === 'mention') {\n            // pass dummy mention suggestions\n            done([{name: 'John Doe', id: '101', email: 'joe@gmail.com'}, {name: 'Joe Lewis', id: '102', email: 'lewis@gmail.com'}])\n        } else if (type === 'tag') {\n            // pass dummy tag suggestions\n            done([{tag: 'WikiLeaks'}, {tag: 'NetNeutrality'}, {tag: 'NetNeutrality'}])\n        }else{\n            done([{id:1,tag: '-> WikiLeaks'}, {id:2,tag: '-> NetNeutrality'}, {id:3,tag: '-> NetNeutrality'}])\n        }\n        \n      }, 0);\n    },\n    getSuggestionsHTML: (items, type) =>  {\n      if (type === 'mention') {\n        return getMentionSuggestionsHTML(items)\n      } else if (type === 'tag') {\n        return getTagSuggestionsHTML(items)\n      } else if (type === 'arrow') {\n        return getTagSuggestionsHTML(items)\n      }\n      \n    }\n});\n\nplugins.unshift(mentionPlugin); // push it before keymap plugin to override keydown handlers\nplugins.unshift(customKM); // push it before keymap plugin to override keydown handlers\n\n//mention\n\n\nvar createEditor = function (element) {\n\n  window.view = new EditorView(element, {\n  state: EditorState.create({\n      doc: DOMParser.fromSchema(mySchema).parse(document.querySelector(\"#content\")),\n      plugins: plugins\n     // plugins: prosemirrorExampleSetup.exampleSetup({schema: prosemirrorSchemaBasic.schema}).concat(lintPlugin)\n    })\n  })\n  return window.view ;\n}\n\nexport default createEditor\n","//linter \n\nimport {Decoration, DecorationSet} from \"prosemirror-view\"\n\nimport {Plugin, TextSelection} from \"prosemirror-state\"\n\nlet lintPlugin = new Plugin({\n  state: {\n    init(_, {doc}) { return lintDeco(doc) },\n    apply(tr, old) { return tr.docChanged ? lintDeco(tr.doc) : old }\n  },\n  props: {\n    decorations(state) { return this.getState(state) },\n    handleClick(view, _, event) {\n      if (/lint-icon/.test(event.target.className)) {\n        let {from, to} = event.target.problem\n        view.dispatch(\n          view.state.tr\n            .setSelection(TextSelection.create(view.state.doc, from, to))\n            .scrollIntoView())\n        return true\n      }\n    },\n    handleDoubleClick(view, _, event) {\n      if (/lint-icon/.test(event.target.className)) {\n        let prob = event.target.problem\n        if (prob.fix) {\n          prob.fix(view)\n          view.focus()\n          return true\n        }\n      }\n    }\n  }\n})\n\n\nfunction lintDeco(doc) {\n  let decos = []\n  lint(doc).forEach(prob => {\n    decos.push(Decoration.inline(prob.from, prob.to, {class: \"problem\"}),\n               Decoration.widget(prob.from, lintIcon(prob)))\n  })\n  return DecorationSet.create(doc, decos)\n}\n\nfunction lintIcon(prob) {\n  let icon = document.createElement(\"div\")\n  icon.className = \"lint-icon\"\n  icon.title = prob.msg\n  icon.problem = prob\n  return icon\n}\n\n// Words you probably shouldn't use\nconst badWords = /\\b(obviously|clearly|evidently|simply)\\b/ig\n// Matches punctuation with a space before it\nconst badPunc = / ([,\\.!?:]) ?/g\n// Matches punctuation with a space before it\nconst goToLinks = /->/ig\n\nfunction lint(doc) {\n  let result = [], lastHeadLevel = null\n\n  function record(msg, from, to, fix) {\n    result.push({msg, from, to, fix})\n  }\n\n  // For each node in the document\n  doc.descendants((node, pos) => {\n    if (node.isText) {\n      // Scan text nodes for suspicious patterns\n      let m\n      while (m = goToLinks.exec(node.text))\n        record(`GoTo '${m[0]}'`,\n               pos + m.index, pos + m.index + m[0].length)\n      while (m = badWords.exec(node.text))\n        record(`Try not to say '${m[0]}'`,\n               pos + m.index, pos + m.index + m[0].length)\n      while (m = badPunc.exec(node.text))\n        record(\"Suspicious spacing around punctuation\",\n               pos + m.index, pos + m.index + m[0].length,\n               fixPunc(m[1] + \" \"))\n    } else if (node.type.name == \"heading\") {\n      // Check whether heading levels fit under the current level\n      let level = node.attrs.level\n      if (lastHeadLevel != null && level > lastHeadLevel + 1)\n        record(`Heading too small (${level} under ${lastHeadLevel})`,\n               pos + 1, pos + 1 + node.content.size,\n               fixHeader(lastHeadLevel + 1))\n      lastHeadLevel = level\n    } else if (node.type.name == \"image\" && !node.attrs.alt) {\n      // Ensure images have alt text\n      record(\"Image without alt text\", pos, pos + 1, addAlt)\n    }\n  })\n\n  return result\n}\n\nfunction fixPunc(replacement) {\n  return function({state, dispatch}) {\n    dispatch(state.tr.replaceWith(this.from, this.to,\n                                  state.schema.text(replacement)))\n  }\n}\n\nfunction fixHeader(level) {\n  return function({state, dispatch}) {\n    dispatch(state.tr.setNodeMarkup(this.from - 1, null, {level}))\n  }\n}\n\nfunction addAlt({state, dispatch}) {\n  let alt = prompt(\"Alt text\", \"\")\n  if (alt) {\n    let attrs = Object.assign({}, state.doc.nodeAt(this.from).attrs, {alt})\n    dispatch(state.tr.setNodeMarkup(this.from, null, attrs))\n  }\n}\n\nexport {lintPlugin}\n\n\n\n","export { getMentionsPlugin } from \"./mentionPlugin\";\nexport { addMentionNodes, addTagNodes, addArrowNodes  } from \"./utils\";\nexport { tagNode, mentionNode } from \"./nodes\";\n","import { Plugin, PluginKey } from \"prosemirror-state\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\n\n/**\n *\n * @param {String} mentionTrigger\n * @param {String} hashtagTrigger\n * @param {bool} allowSpace\n * @returns {Object}\n */\nexport function getRegexp(mentionTrigger, hashtagTrigger, allowSpace) {\n  var mention = allowSpace\n    ? new RegExp(\"(^|\\\\s)\" + mentionTrigger + \"([\\\\w-\\\\+]+\\\\s?[\\\\w-\\\\+]*)$\")\n    : new RegExp(\"(^|\\\\s)\" + mentionTrigger + \"([\\\\w-\\\\+]+)$\");\n  \n  var arrow = new RegExp(\"(^|\\\\s)\" + \"->\" + \"([\\\\w-\\\\+]+\\\\s?[\\\\w-\\\\+]*)$\")\n\n\n  // hashtags should never allow spaces. I mean, what's the point of allowing spaces in hashtags?\n  var tag = new RegExp(\"(^|\\\\s)\" + hashtagTrigger + \"([\\\\w-]+)$\");\n\n  return {\n    mention: mention,\n    tag: tag,\n    arrow: arrow,\n  };\n}\n\n/**\n *\n * @param {ResolvedPosition} $position https://prosemirror.net/docs/ref/#model.Resolved_Positions\n * @param {JSONObject} opts\n * @returns {JSONObject}\n */\nexport function getMatch($position, opts) {\n  // take current para text content upto cursor start.\n  // this makes the regex simpler and parsing the matches easier.\n  var parastart = $position.before();\n  const text = $position.doc.textBetween(parastart, $position.pos, \"\\n\", \"\\0\");\n\n  var regex = getRegexp(\n    opts.mentionTrigger,\n    opts.hashtagTrigger,\n    opts.allowSpace\n  );\n\n  // only one of the below matches will be true.\n  var mentionMatch = text.match(regex.mention);\n  var tagMatch = text.match(regex.tag);\n  var arrowMatch = text.match(regex.arrow);\n\n  var match = mentionMatch || tagMatch || arrowMatch;\n\n  // set type of match\n  var type;\n  if (mentionMatch) {\n    type = \"mention\";\n  } else if (tagMatch) {\n    type = \"tag\";\n  }else if (arrowMatch) {\n    type = \"arrow\";\n  }\n\n  // if match found, return match with useful information.\n  if (match) {\n    // adjust match.index to remove the matched extra space\n    match.index = match[0].startsWith(\" \") ? match.index + 1 : match.index;\n    match[0] = match[0].startsWith(\" \")\n      ? match[0].substring(1, match[0].length)\n      : match[0];\n\n    // The absolute position of the match in the document\n    var from = $position.start() + match.index;\n    var to = from + match[0].length;\n\n    var queryText = match[2];\n\n    return {\n      range: { from: from, to: to },\n      queryText: queryText,\n      type: type\n    };\n  }\n  // else if no match don't return anything.\n}\n\n/**\n * Util to debounce call to a function.\n * >>> debounce(function(){}, 1000, this)\n */\nexport const debounce = (function() {\n  var timeoutId = null;\n  return function(func, timeout, context) {\n    context = context || this;\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(function() {\n      func.apply(context, arguments);\n    }, timeout);\n\n    return timeoutId;\n  };\n})();\n\nvar getNewState = function() {\n  return {\n    active: false,\n    range: {\n      from: 0,\n      to: 0\n    },\n    type: \"\", //mention or tag\n    text: \"\",\n    suggestions: [],\n    index: 0 // current active suggestion index\n  };\n};\n\n/**\n * @param {JSONObject} opts\n * @returns {Plugin}\n */\nexport function getMentionsPlugin(opts) {\n  // default options\n  var defaultOpts = {\n    mentionTrigger: \"@\",\n    hashtagTrigger: \"#\",\n    functionOnClick: (event)=> console.log(event),\n    allowSpace: true,\n    getSuggestions: (type, text, cb) => {\n      cb([]);\n    },\n    getSuggestionsHTML: items =>\n      '<div class=\"suggestion-item-list\">' +\n      items\n        .map(i => '<div class=\"suggestion-item\">' + i.name + \"</div>\")\n        .join(\"\") +\n      \"</div>\",\n    activeClass: \"suggestion-item-active\",\n    suggestionTextClass: \"prosemirror-suggestion\",\n    maxNoOfSuggestions: 10,\n    delay: 500\n  };\n\n  var opts = Object.assign({}, defaultOpts, opts);\n\n  // timeoutId for clearing debounced calls\n  var showListTimeoutId = null;\n\n  // dropdown element\n  var el = document.createElement(\"div\");\n\n  // current Idx\n  var index = 0;\n\n  // ----- methods operating on above properties -----\n\n  var showList = function(view, state, suggestions, opts) {\n    el.innerHTML = opts.getSuggestionsHTML(suggestions, state.type);\n\n    // attach new item event handlers\n    el.querySelectorAll(\".suggestion-item\").forEach(function(itemNode, index) {\n      itemNode.addEventListener(\"click\", function() {\n        select(view, state, opts);\n        view.focus();\n      });\n      // TODO: setIndex() needlessly queries.\n      // We already have the itemNode. SHOULD OPTIMIZE.\n      itemNode.addEventListener(\"mouseover\", function() {\n        setIndex(index, state, opts);\n      });\n      itemNode.addEventListener(\"mouseout\", function() {\n        setIndex(index, state, opts);\n      });\n    });\n\n    // highlight first element by default - like Facebook.\n    addClassAtIndex(state.index, opts.activeClass);\n\n    // get current @mention span left and top.\n    // TODO: knock off domAtPos usage. It's not documented and is not officially a public API.\n    // It's used currently, only to optimize the the query for textDOM\n    var node = view.domAtPos(view.state.selection.$from.pos);\n    var paraDOM = node.node;\n    var textDOM = paraDOM.querySelector(\".\" + opts.suggestionTextClass);\n\n    // TODO: should add null check case for textDOM\n    var offset = textDOM.getBoundingClientRect();\n\n    // TODO: think about outsourcing this positioning logic as options\n    document.body.appendChild(el);\n    el.classList.add('suggestion-item-container')\n    el.style.position = \"fixed\";\n    el.style.left = offset.left + \"px\";\n\n    var top = textDOM.offsetHeight + offset.top;\n    el.style.top = top + \"px\";\n    el.style.display = \"block\";\n    el.style.zIndex = \"999999\";\n  };\n\n  var hideList = function() {\n    el.style.display = \"none\";\n  };\n\n  var removeClassAtIndex = function(index, className) {\n    var itemList = el.querySelector(\".suggestion-item-list\").childNodes;\n    var prevItem = itemList[index];\n    prevItem.classList.remove(className);\n  };\n\n  var addClassAtIndex = function(index, className) {\n    var itemList = el.querySelector(\".suggestion-item-list\").childNodes;\n    var prevItem = itemList[index];\n    prevItem.classList.add(className);\n  };\n\n  var setIndex = function(index, state, opts) {\n    removeClassAtIndex(state.index, opts.activeClass);\n    state.index = index;\n    addClassAtIndex(state.index, opts.activeClass);\n  };\n\n  var goNext = function(view, state, opts) {\n    removeClassAtIndex(state.index, opts.activeClass);\n    state.index++;\n    state.index = state.index === state.suggestions.length ? 0 : state.index;\n    addClassAtIndex(state.index, opts.activeClass);\n  };\n\n  var goPrev = function(view, state, opts) {\n    removeClassAtIndex(state.index, opts.activeClass);\n    state.index--;\n    state.index =\n      state.index === -1 ? state.suggestions.length - 1 : state.index;\n    addClassAtIndex(state.index, opts.activeClass);\n  };\n\n  var select = function(view, state, opts) {\n    var item = state.suggestions[state.index];\n    var attrs;\n    if (state.type === \"mention\") {\n      attrs = {\n        name: item.name,\n        id: item.id,\n        email: item.email\n      };\n    } else  if (state.type === \"tag\"){\n      attrs = {\n        tag: item.tag\n      };\n    }else {\n      attrs = {\n        tag: item.tag,\n        id: item.id,\n        text: item.tag,\n      };\n    }\n    var node = view.state.schema.nodes[state.type].create(attrs);\n    var tr = view.state.tr.replaceWith(state.range.from, state.range.to, node);\n\n    //var newState = view.state.apply(tr);\n    //view.updateState(newState);\n    view.dispatch(tr)\n  };\n\n  /**\n   * See https://prosemirror.net/docs/ref/#state.Plugin_System\n   * for the plugin properties spec.\n   */\n  return new Plugin({\n    key: new PluginKey(\"autosuggestions\"),\n\n    // we will need state to track if suggestion dropdown is currently active or not\n    state: {\n      init() {\n        return getNewState();\n      },\n\n      apply(tr, state) {\n        // compute state.active for current transaction and return\n        var newState = getNewState();\n        var selection = tr.selection;\n        if (selection.from !== selection.to) {\n          return newState;\n        }\n\n        const $position = selection.$from;\n        const match = getMatch($position, opts);\n\n        // if match found update state\n        if (match) {\n          newState.active = true;\n          newState.range = match.range;\n          newState.type = match.type;\n          newState.text = match.queryText;\n        }\n\n        return newState;\n      }\n    },\n\n    // We'll need props to hi-jack keydown/keyup & enter events when suggestion dropdown\n    // is active.\n    props: {\n      handleKeyDown(view, e) {\n        var state = this.getState(view.state);\n\n        // don't handle if no suggestions or not in active mode\n        if (!state.active && !state.suggestions.length) {\n          return false;\n        }\n\n        // if any of the below keys, override with custom handlers.\n        var down, up, enter, esc;\n        enter = e.keyCode === 13;\n        down = e.keyCode === 40;\n        up = e.keyCode === 38;\n        esc = e.keyCode === 27;\n\n        if (down) {\n          goNext(view, state, opts);\n          return true;\n        } else if (up) {\n          goPrev(view, state, opts);\n          return true;\n        } else if (enter) {\n          select(view, state, opts);\n          return true;\n        } else if (esc) {\n          clearTimeout(showListTimeoutId);\n          hideList();\n          this.state = getNewState();\n          return true;\n        } else {\n          // didn't handle. handover to prosemirror for handling.\n          return false;\n        }\n      },\n      handleClick(view, _, event) {\n        if (/prosemirror-mention-node/.test(event.target.className)) {\n          opts.functionOnClick(event, view)\n          // let {from, to} = event.target.problem\n          // view.dispatch(\n          //   view.state.tr\n          //     .setSelection(TextSelection.create(view.state.doc, from, to))\n          //     .scrollIntoView())\n          return true\n        }\n      },\n\n      // to decorate the currently active @mention text in ui\n      decorations(editorState) {\n        const { active, range } = this.getState(editorState);\n\n        if (!active) return null;\n\n        return DecorationSet.create(editorState.doc, [\n          Decoration.inline(range.from, range.to, {\n            nodeName: \"span\",\n            class: opts.suggestionTextClass\n          })\n        ]);\n      }\n    },\n\n    // To track down state mutations and add dropdown reactions\n    view() {\n      return {\n        update: view => {\n          var state = this.key.getState(view.state);\n          if (!state.text) {\n            hideList();\n            clearTimeout(showListTimeoutId);\n            return;\n          }\n          // debounce the call to avoid multiple requests\n          showListTimeoutId = debounce(\n            function() {\n              // get suggestions and set new state\n              opts.getSuggestions(state.type, state.text, function(\n                suggestions\n              ) {\n                // update `state` argument with suggestions\n                state.suggestions = suggestions;\n                showList(view, state, suggestions, opts);\n              });\n            },\n            opts.delay,\n            this\n          );\n        }\n      };\n    }\n  });\n}\n","import { tagNode, mentionNode, arrowNode } from \"./nodes\";\n\n/**\n *\n * @param {OrderedMap} nodes\n * @returns {OrderedMap}\n */\nexport function addMentionNodes(nodes) {\n  return nodes.append({\n    mention: mentionNode\n  });\n}\n\n/**\n *\n * @param {OrderedMap} nodes\n * @returns {OrderedMap}\n */\nexport function addTagNodes(nodes) {\n  return nodes.append({\n    tag: tagNode\n  });\n}\n\n/**\n *\n * @param {OrderedMap} nodes\n * @returns {OrderedMap}\n */\nexport function addArrowNodes(nodes) {\n  return nodes.append({\n    arrow: arrowNode\n  });\n}\n","/**\n * See https://prosemirror.net/docs/ref/#model.NodeSpec\n */\nexport const mentionNode = {\n  group: \"inline\",\n  inline: true,\n  atom: true,\n\n  attrs: {\n    id: \"\",\n    name: \"\",\n    email: \"\"\n  },\n\n  selectable: false,\n  draggable: false,\n\n  toDOM: node => {\n    return [\n      \"span\",\n      {\n        \"data-mention-id\": node.attrs.id,\n        \"data-mention-name\": node.attrs.name,\n        \"data-mention-email\": node.attrs.email,\n        class: \"prosemirror-mention-node\"\n      },\n      \"@\" + node.attrs.name || node.attrs.email\n    ];\n  },\n\n  parseDOM: [\n    {\n      // match tag with following CSS Selector\n      tag: \"span[data-mention-id][data-mention-name][data-mention-email]\",\n\n      getAttrs: dom => {\n        var id = dom.getAttribute(\"data-mention-id\");\n        var name = dom.getAttribute(\"data-mention-name\");\n        var email = dom.getAttribute(\"data-mention-email\");\n        return {\n          id: id,\n          name: name,\n          email: email\n        };\n      }\n    }\n  ]\n};\n\n/**\n * See https://prosemirror.net/docs/ref/#model.NodeSpec\n */\nexport const tagNode = {\n  group: \"inline\",\n  inline: true,\n  atom: true,\n\n  attrs: {\n    tag: \"\"\n  },\n\n  selectable: false,\n  draggable: false,\n\n  toDOM: node => {\n    return [\n      \"span\",\n      {\n        \"data-tag\": node.attrs.tag,\n        class: \"prosemirror-tag-node\"\n      },\n      \"#\" + node.attrs.tag\n    ];\n  },\n\n  parseDOM: [\n    {\n      // match tag with following CSS Selector\n      tag: \"span[data-tag]\",\n\n      getAttrs: dom => {\n        var tag = dom.getAttribute(\"data-tag\");\n        return {\n          tag: tag\n        };\n      }\n    }\n  ]\n};\n\n/**\n * See https://prosemirror.net/docs/ref/#model.NodeSpec\n */\nexport const arrowNode = {\n  group: \"inline\",\n  inline: true,\n  atom: true,\n\n  attrs: {\n    id: \"\",\n    tag:\"\",\n    text:\"\",\n  },\n\n  selectable: false,\n  draggable: false,\n\n  toDOM: node => {\n    return [\n      \"span\",\n      {\n        \"data-mention-id\": node.attrs.id,\n        \"data-mention-tag\": node.attrs.tag,\n        class: \"prosemirror-mention-node\"\n      },\n       node.attrs.tag || node.attrs.text\n    ];\n  },\n\n  parseDOM: [\n    {\n      // match tag with following CSS Selector\n      tag: \"span[data-mention-id][data-mention-tag]\",\n\n      getAttrs: dom => {\n        var id = dom.getAttribute(\"data-mention-id\");\n        var tag = dom.getAttribute(\"data-mention-tag\");\n        var text = dom.getAttribute(\"data-mention-tag\");\n        return {\n          id: id,\n          tag: tag,\n        };\n      }\n    }\n  ]\n};\n"],"names":[],"version":3,"file":"index.js.map"}